<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DASBEM — Loader</title>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark:#0b0f12;
  --accent:#ffb347;
  --muted:#7b8a8f;
}

* {box-sizing:border-box;margin:0;padding:0;}
html,body {height:100%;width:100%;overflow:hidden;font-family:'Fira Code', monospace;background:var(--bg-dark);color:#fff;}

#loader {
  position:fixed;inset:0;
  background:var(--bg-dark);
  display:flex;align-items:center;justify-content:center;
  flex-direction:column;
  z-index:9999;
  overflow:hidden;
}

#loader canvas {
  position:absolute;inset:0;width:100%;height:100%;
}

#term {
  position:relative;
  width:80%;max-width:900px;
  height:360px;
  padding:20px;
  background:rgba(11,15,18,0.85);
  border-radius:14px;
  box-shadow:0 10px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  overflow:hidden;
  display:flex;flex-direction:column;
  justify-content:flex-start;
  gap:6px;
}

.line {
  color:var(--accent);
  font-size:14px;
  opacity:0;
  transform:translateY(15px);
}

.fade-in {
  animation:fadeInLine 0.6s forwards;
}

@keyframes fadeInLine {
  0% {opacity:0; transform:translateY(15px);}
  100% {opacity:1; transform:translateY(0);}
}

#progress {
  margin-top:auto;
  height:10px;
  background:rgba(255,255,255,0.03);
  border-radius:999px;
  overflow:hidden;
}

#progress .fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg, rgba(255,179,71,0.3), rgba(255,179,71,0.7));
  box-shadow:0 0 20px rgba(255,179,71,0.3);
  transition:width 0.4s linear;
}

/* Fade out for loader */
.loader-hidden {
  opacity:0;
  visibility:hidden;
  transition:opacity 0.6s ease, visibility 0.6s ease;
}

/* Main content hidden initially */
main.app {
  min-height:100vh;
  display:flex;align-items:center;justify-content:center;
  color:#fff;
  font-family:"Fira Code", monospace;
  font-size:20px;
  opacity:0;
  visibility:hidden;
  transition:opacity 0.6s ease, visibility 0s 0.6s;
}

</style>
</head>
<body>

<div id="loader">
  <canvas id="bgCanvas"></canvas>
  <div id="term"></div>
  <div id="progress"><div class="fill" id="barFill"></div></div>
</div>

<main class="app">
  <div>صفحهٔ اصلی پروژهٔ DASBEM آماده است!</div>
</main>

<script>
// ====== Canvas Background ======
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

const particles = Array.from({length:120}, () => ({
  x:Math.random()*W,
  y:Math.random()*H,
  r:Math.random()*2+1,
  vx:(Math.random()-0.5)*0.5,
  vy:(Math.random()-0.5)*0.5,
}));

function drawCanvas(){
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle = 'rgba(255,179,71,0.02)';
  ctx.beginPath();
  for(let p of particles){
    ctx.moveTo(p.x,p.y);
    ctx.arc(p.x,p.y,p.r,0,2*Math.PI);
    p.x+=p.vx; p.y+=p.vy;
    if(p.x<0||p.x>W)p.vx*=-1;
    if(p.y<0||p.y>H)p.vy*=-1;
  }
  ctx.fill();
  requestAnimationFrame(drawCanvas);
}
drawCanvas();
window.addEventListener('resize',()=>{
  W=canvas.width=window.innerWidth;
  H=canvas.height=window.innerHeight;
});

// ====== Terminal Text ======
const term = document.getElementById('term');
const lines = [
  "system: initializing kernel modules...",
  "core: allocating boundary elements...",
  "solver: loading BEM matrices...",
  "compute: assembling influence coefficients...",
  "mesh: generating semicircular domain...",
  "opt: optimizing solver parameters...",
  "status: computation ready, launching UI..."
];

async function runLines(duration=5000){
  const lineDelay = duration / lines.length;
  const bar = document.getElementById('barFill');
  for(let i=0;i<lines.length;i++){
    const div = document.createElement('div');
    div.className='line';
    div.textContent=lines[i];
    term.appendChild(div);
    setTimeout(()=>div.classList.add('fade-in'),50);
    bar.style.width = ((i+1)/lines.length*100)+'%';
    await new Promise(r=>setTimeout(r,lineDelay));
  }
}

// ====== Loader Orchestration ======
runLines(5000).then(()=>{
  const loader=document.getElementById('loader');
  loader.classList.add('loader-hidden');
  const main=document.querySelector('main.app');
  main.style.visibility='visible';
  main.style.opacity='1';
});
</script>
</body>
</html>
