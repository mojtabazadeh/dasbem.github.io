<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DASBEM — Loader</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Inter:wght@300;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0f12;
    --panel:#071018;
    --accent:#39ff14; /* فسفری terminal */
    --muted:#7b8a8f;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(15,20,25,0.6), transparent),
                linear-gradient(180deg, #050608 0%, #071018 60%);
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Fira Code", monospace;
    color: #e6f2e6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow:hidden;
  }

  /* loader container */
  .loader-wrap{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:32px;
    padding:24px;
    z-index:9999;
    transition:opacity 600ms ease, visibility 600ms ease;
    background: linear-gradient(180deg, rgba(3,6,8,0.6), rgba(3,6,8,0.35));
    backdrop-filter: blur(4px);
  }

  .card{
    width:880px;
    max-width:calc(100% - 48px);
    height:460px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    display:flex;
    overflow:hidden;
  }

  /* left: terminal */
  .terminal{
    width:44%;
    min-width:300px;
    padding:22px;
    background:
      linear-gradient(180deg, rgba(12,16,18,0.6), rgba(6,8,10,0.7));
    border-right:1px solid rgba(255,255,255,0.02);
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .term-top{
    display:flex;
    align-items:center;
    gap:10px;
  }
  .dots{
    display:flex;
    gap:6px;
  }
  .dot{
    width:10px;height:10px;border-radius:50%;
    background:#ff5f56; box-shadow:0 1px 0 rgba(0,0,0,0.8) inset;
  }
  .dot.y{background:#ffbd2e}
  .dot.g{background:#27c93f}

  .term-body{
    margin-top:6px;
    padding:12px;
    background: linear-gradient(180deg, rgba(0,0,0,0.02), transparent);
    border-radius:8px;
    height:330px;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    gap:8px;
  }

  .console-line{
    font-family: "Fira Code", monospace;
    font-size:13px;
    color:var(--muted);
    line-height:1.4;
    white-space:nowrap;
    display:flex;
    align-items:center;
    gap:8px;
  }

  .console-line .tag{
    color:var(--accent);
    min-width:120px;
    font-weight:600;
    font-size:12px;
  }
  .console-line .value{color:#c1f7b7}

  .typing{
    color:var(--accent);
    font-weight:700;
    font-size:14px;
  }

  .progress{
    margin-top:auto;
    display:flex;
    gap:12px;
    align-items:center;
  }
  .bar{
    flex:1;
    height:10px;
    background:rgba(255,255,255,0.03);
    border-radius:999px;
    overflow:hidden;
    position:relative;
  }
  .bar .fill{
    position:absolute;
    left:0;top:0;bottom:0;
    width:0%;
    background: linear-gradient(90deg, rgba(57,255,20,0.15), rgba(57,255,20,0.28));
    box-shadow: 0 0 20px rgba(57,255,20,0.06);
    transition: width 400ms linear;
  }
  .spinner{
    width:38px;height:38px;border-radius:50%;
    display:grid;place-items:center;
    border:2px solid rgba(255,255,255,0.03);
    position:relative;
  }
  .spinner::after{
    content:"";
    width:18px;height:18px;border-radius:50%;
    box-shadow: 0 0 18px rgba(57,255,20,0.08);
    border:3px solid var(--accent);
    border-top-color: transparent;
    animation: spin 900ms linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}

  /* right: canvas / geometry */
  .visual{
    flex:1;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    background: radial-gradient(800px 400px at 80% 20%, rgba(57,255,20,0.02), transparent);
  }

  canvas{
    width:100%;
    height:100%;
    display:block;
    background:
      linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  }

  /* fade-out class */
  .loader-hidden{
    opacity:0;
    visibility:hidden;
    pointer-events:none;
  }

  /* main content placeholder */
  main.app{
    min-height:100vh;
    display:flex;align-items:center;justify-content:center;
    color:#dfeef0;
    font-family:"Inter",sans-serif;
    font-size:20px;
  }
  .app-card{
    padding:28px 36px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    text-align:center;
  }
  .app-card h1{margin:0 0 8px 0;font-size:28px}
  .app-card p{margin:0;color:var(--muted)}
  @media (max-width:880px){
    .card{height:520px;flex-direction:column}
    .terminal{width:100%;height:46%}
    .visual{width:100%;height:54%}
  }
</style>
</head>
<body>

<!-- LOADER -->
<div class="loader-wrap" id="loader">
  <div class="card" role="dialog" aria-label="DASBEM loading screen">
    <div class="terminal" aria-hidden="false">
      <div class="term-top">
        <div class="dots">
          <div class="dot"></div><div class="dot y"></div><div class="dot g"></div>
        </div>
        <div style="flex:1"></div>
        <div style="font-family:'Fira Code',monospace; font-size:12px;color:var(--muted)">v1.0 • DASBEM</div>
      </div>

      <div class="term-body" id="termBody">
        <div class="console-line"><span class="tag">system</span><span class="value">booting kernel modules...</span></div>
        <div class="console-line"><span class="tag">core</span><span class="value">allocating boundary elements...</span></div>
        <div class="console-line typing" id="typingLine"></div>
        <!-- dynamic console lines -->
      </div>

      <div class="progress" aria-hidden="true">
        <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" id="progressBar">
          <div class="fill" id="barFill"></div>
        </div>
        <div class="spinner" aria-hidden="true"></div>
      </div>
    </div>

    <div class="visual" aria-hidden="true">
      <canvas id="visCanvas" width="800" height="460" role="img" aria-label="Boundary element wave visualization"></canvas>
    </div>
  </div>
</div>

<!-- MAIN CONTENT (hidden until loader hidden) -->
<main class="app" id="mainApp" style="visibility:hidden;opacity:0;transition:opacity 600ms ease, visibility 0s 600ms;">
  <div class="app-card">
    <h1>صفحهٔ اصلی پروژهٔ DASBEM</h1>
    <p>اینجا محتوای سایت قرار می‌گیرد — لودر آماده است.</p>
  </div>
</main>

<script>
/* ========== Configuration ========== */
/* user-provided/init text */
const initText = "Initializing DASBEM Project";
/* duration: 5000 ms (assumed) */
const LOADER_DURATION = 5000;

/* ========== Terminal typing effect ========== */
const typingLine = document.getElementById('typingLine');
const termBody = document.getElementById('termBody');
const barFill = document.getElementById('barFill');

function typeText(el, text, speed=40){
  return new Promise((resolve) => {
    el.textContent = "";
    let i=0;
    const tick = () => {
      if(i<=text.length){
        el.textContent = text.slice(0,i) + (i%2? "▌":"");
        i++;
        setTimeout(tick, speed + (Math.random()*30 - 15));
      } else {
        el.textContent = text;
        resolve();
      }
    };
    tick();
  });
}

/* add small console lines after typing */
function pushConsole(tag, value){
  const div = document.createElement('div');
  div.className = 'console-line';
  div.innerHTML = `<span class="tag">${tag}</span><span class="value">${value}</span>`;
  termBody.appendChild(div);
  // scroll if overflow
  termBody.scrollTop = termBody.scrollHeight;
}

/* progress bar animation */
function setProgress(p){
  barFill.style.width = Math.max(0, Math.min(100,p)) + "%";
}

/* sequential terminal script */
async function runTerminalSequence(){
  setProgress(6);
  await new Promise(r=>setTimeout(r, 220));
  pushConsole("solver","loading boundary kernels...");
  setProgress(14);
  await new Promise(r=>setTimeout(r, 400));
  pushConsole("mesh","generating semicircular domain (BEM)...");
  setProgress(32);
  await new Promise(r=>setTimeout(r, 360));
  await typeText(typingLine, initText + " ...");
  setProgress(52);
  await new Promise(r=>setTimeout(r, 300));
  pushConsole("compute","assembling influence matrices...");
  setProgress(68);
  await new Promise(r=>setTimeout(r, 520));
  pushConsole("opt","optimizing solver parameters...");
  setProgress(82);
}

/* ========== Canvas visualization (semicircle mesh + wave) ========== */
const canvas = document.getElementById('visCanvas');
const ctx = canvas.getContext('2d');

let W = canvas.width;
let H = canvas.height;
function resize(){
  const rect = canvas.getBoundingClientRect();
  W = canvas.width = rect.width * devicePixelRatio;
  H = canvas.height = rect.height * devicePixelRatio;
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
resize();
window.addEventListener('resize', () => { resize(); });

/* geometry */
const center = {x: W/ (2*devicePixelRatio), y: H*0.65 / (devicePixelRatio)};
const R = Math.min(W/(2*devicePixelRatio), H*0.9/(devicePixelRatio)) * 0.92;
const rings = 9;    // concentric arcs
const radials = 28; // radial lines (mesh)
let tStart = null;

/* draw mesh once (static) for clarity */
function drawMesh(){
  // subtle background glow
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // grid shadow
  for(let r=0;r<rings;r++){
    const rr = R*(1 - r/(rings));
    ctx.beginPath();
    ctx.arc(center.x, center.y, rr, Math.PI, 2*Math.PI);
    ctx.strokeStyle = "rgba(255,255,255,0.02)";
    ctx.lineWidth = 1;
    ctx.stroke();
  }
  // radial lines
  for(let i=0;i<=radials;i++){
    const ang = Math.PI + (i / radials) * Math.PI;
    const x2 = center.x + Math.cos(ang)*R;
    const y2 = center.y + Math.sin(ang)*R;
    ctx.beginPath();
    ctx.moveTo(center.x, center.y);
    ctx.lineTo(x2,y2);
    ctx.strokeStyle = "rgba(255,255,255,0.02)";
    ctx.lineWidth = 0.9;
    ctx.stroke();
  }
  // domain outline
  ctx.beginPath();
  ctx.arc(center.x, center.y, R, Math.PI, 2*Math.PI);
  ctx.strokeStyle = "rgba(57,255,20,0.06)";
  ctx.lineWidth = 1.6;
  ctx.stroke();
}

/* wave animation: draw brighter arcs that move outward */
function waveFrame(time){
  if(!tStart) tStart = time;
  const t = (time - tStart) / 1000; // seconds
  // clear but keep faint background
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // soft background radial
  const g = ctx.createRadialGradient(center.x, center.y - R*0.2, R*0.1, center.x, center.y, R*1.6);
  g.addColorStop(0, "rgba(57,255,20,0.02)");
  g.addColorStop(1, "rgba(0,0,0,0)");
  ctx.fillStyle = g;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // base mesh (very subtle)
  for(let r=0;r<rings;r++){
    const rr = R*(1 - r/(rings));
    ctx.beginPath();
    ctx.arc(center.x, center.y, rr, Math.PI, 2*Math.PI);
    ctx.strokeStyle = "rgba(255,255,255,0.02)";
    ctx.lineWidth = 1;
    ctx.stroke();
  }
  for(let i=0;i<=radials;i++){
    const ang = Math.PI + (i / radials) * Math.PI;
    const x2 = center.x + Math.cos(ang)*R;
    const y2 = center.y + Math.sin(ang)*R;
    ctx.beginPath();
    ctx.moveTo(center.x, center.y);
    ctx.lineTo(x2,y2);
    ctx.strokeStyle = "rgba(255,255,255,0.02)";
    ctx.lineWidth = 0.9;
    ctx.stroke();
  }

  // animated wavefronts
  const speed = 0.8; // wave speed (rings per second)
  const amplitude = 6; // visual amplitude
  for(let k=0;k<3;k++){
    // each wave has different phase and fading
    const phase = t*speed - k*0.9;
    for(let r=0;r<rings;r++){
      const rr = R*(1 - r/(rings));
      // intensity depends on distance to wavefront
      const wavePos = (phase % (rings)) ;
      const diff = Math.abs(r - wavePos);
      const intensity = Math.max(0, 1 - diff/1.6) * Math.exp(-k*0.6);
      if(intensity < 0.01) continue;
      ctx.beginPath();
      ctx.arc(center.x, center.y, rr, Math.PI, 2*Math.PI);
      ctx.strokeStyle = `rgba(57,255,20,${0.06 * intensity})`;
      ctx.lineWidth = 1.8 + amplitude*intensity*0.7;
      ctx.stroke();
    }
  }

  // small particle along wave to hint propagation (optional)
  const particleRadius = 3 + Math.sin(t*4)*1.2;
  const particleRing = (t*speed) % rings;
  const pr = R*(1 - particleRing/(rings)) ;
  const pAng = Math.PI + (0.25 + 0.5*Math.sin(t*1.2))*Math.PI; // sweep a bit
  const px = center.x + Math.cos(pAng)*pr;
  const py = center.y + Math.sin(pAng)*pr;
  ctx.beginPath();
  ctx.arc(px,py, particleRadius, 0, Math.PI*2);
  ctx.fillStyle = "rgba(57,255,20,0.95)";
  ctx.fill();

  // subtle axes/text
  ctx.font = "12px 'Fira Code', monospace";
  ctx.fillStyle = "rgba(255,255,255,0.03)";
  ctx.fillText("BEM domain • semicircular mesh", center.x - R*0.95, center.y + R*0.5);

  // request next frame
  requestAnimationFrame(waveFrame);
}

/* ========== Orchestration & lifecycle ========== */
const loader = document.getElementById('loader');
const mainApp = document.getElementById('mainApp');

async function runLoader(){
  drawMesh();
  // start canvas animation
  requestAnimationFrame(waveFrame);

  // run terminal sequence in background
  runTerminalSequence();

  // animate progress gradually to 92% over LOADER_DURATION
  const start = performance.now();
  function progLoop(now){
    const elapsed = now - start;
    const pct = Math.min(92, 6 + (elapsed/LOADER_DURATION) * 86);
    setProgress(pct);
    if(elapsed < LOADER_DURATION){
      requestAnimationFrame(progLoop);
    } else {
      // finalize
      setProgress(100);
      // push final console lines
      pushConsole("status","solver ready — launching UI...");
      setTimeout(hideLoader, 400);
    }
  }
  requestAnimationFrame(progLoop);
}

/* hide loader, reveal main content */
function hideLoader(){
  loader.classList.add('loader-hidden');
  // reveal main after transition
  mainApp.style.visibility = 'visible';
  mainApp.style.opacity = '1';
}

/* start */
runLoader();

</script>
</body>
</html>
